<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>5 User Registration 1.0-RC3</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction to the Spring Security UI Plugin</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/user.html"><strong>2</strong><span>User Management</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/role.html"><strong>3</strong><span>Role Management</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/requestmap.html"><strong>4</strong><span>Requestmap Management</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/userRegistration.html"><strong>5</strong><span>User Registration</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/forgotPassword.html"><strong>6</strong><span>Forgot Password</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/acls.html"><strong>7</strong><span>ACL Management</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/persistentCookie.html"><strong>8</strong><span>Persistent Cookie Management</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/configUI.html"><strong>9</strong><span>Security Configuration UI</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/customization.html"><strong>10</strong><span>Customization</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        
    </div>
    <p>User interface extensions for the Spring Security plugin</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/requestmap.html">&lt;&lt; <strong>4</strong><span>Requestmap Management</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/forgotPassword.html"><strong>6</strong><span>Forgot Password</span> >></a></div>
                


                <div class="project">
                    <h1>5 User Registration - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Burt Beckwith</p>

                    <p><strong>Version:</strong> 1.0-RC3</p>

                    
                </div>

                

                

<h1 id="userRegistration">5 User Registration</h1>
Most of the plugin's controllers are intended to be part of a backend admin application, but the Registration and Forgot Password workflows are expected to be user-facing. So they're not available in the admin menu like the User, Role, and other backend functionality - you'll need to expose them to your users.<p class="paragraph"/>One way to do this is to replace the default <code>login.gsp</code> that's provided by the Spring Security Core plugin with this plugin's version. You can do this by running <code>grails s2ui-override auth</code> - see <a href="../guide/single.html#customization" class="guide">the section on configuration</a> for more details. If you do this your users will have links to both workflows from the login screen:<p class="paragraph"/><img border="0" class="center" src="../img/login.png"></img><p class="paragraph"/><h4>Registration</h4><p class="paragraph"/>Navigate to <code>/register/</code>:<p class="paragraph"/><img border="0" class="center" src="../img/register_start.png"></img><p class="paragraph"/>After filling out valid values an email will be sent and you'll see a success screen:<p class="paragraph"/><img border="0" class="center" src="../img/register_sent.png"></img><p class="paragraph"/>Click on the link in the email:<p class="paragraph"/><img border="0" class="center" src="../img/register_email.png"></img><p class="paragraph"/>and you'll finalize the process, which involves enabling the locked user and pre-authenticating, then redirecting to the configured destination:<p class="paragraph"/><img border="0" class="center" src="../img/register_final.png"></img><p class="paragraph"/><h4>Configuration</h4><p class="paragraph"/>The post-registration destination url is configurable in <code>grails-app/conf/Config.groovy</code> using the <code>postRegisterUrl</code> attribute:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.ui.register.postRegisterUrl = '/welcome'</pre></div><p class="paragraph"/>If you don't specify a value then the <code>grails.plugin.springsecurity.successHandler.defaultTargetUrl</code> value will be used, which is <code>'/'</code> by default.<p class="paragraph"/>You can customize the subject, body, and from address of the registration email by overriding the default values in <code>grails-app/conf/Config.groovy</code>, for example:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.ui.register.emailBody = '...'
grails.plugin.springsecurity.ui.register.emailFrom = '...'
grails.plugin.springsecurity.ui.register.emailSubject = '...'</pre></div><p class="paragraph"/>The <code>emailBody</code> property should be a GString and will have the User domain class instance in scope in the <code>user</code> variable, and the generated url to click to finalize the signup in the <code>url</code> variable.<p class="paragraph"/>In addition, each new user will be granted <code>ROLE_USER</code> after finalizing the registration. If you want to change the default role, add more, or grant no roles at all (for example if you want an admin to approve new users and explicitly enable new users) then you can customize that with the <code>defaultRoleNames</code> attribute (which is a List of Strings):<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.ui.register.defaultRoleNames = &#91;&#93; // no roles</pre></div><p class="paragraph"/>or<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.ui.register.defaultRoleNames = &#91;'ROLE_CUSTOMER'&#93;</pre></div><p class="paragraph"/><h4>Mail configuration</h4><p class="paragraph"/>By default the plugin uses the <a href="http://grails.org/plugin/mail" target="blank">Mail</a> plugin to send emails, but only if it installed. This is configurable by registering your own <code>MailStrategy</code> implementation - see <a href="../guide/single.html#customization" class="guide">the section on configuration</a> for more information. The plugin assumes that the Mail plugin and an SMTP server are already configured.<p class="paragraph"/><h4>Notes</h4><p class="paragraph"/>You should consider the registration code as starter code - every signup workflow will be different, and this should help you get going but is unlikely to be sufficient. You may wish to collect more information than just username and email - first and last name for example. Run <code>grails s2ui-override register</code> to copy the registration controller and GSPs into your application to be customized.<p class="paragraph"/>If there are unexpected validation errors during registration (which can happen when there is a disconnect between the domain classes and the code in <code>RegisterController</code> they will be logged at the <code>warn</code> or <code>error</code> level, so enable logging to ensure that you see the messages, e.g.<p class="paragraph"/><div class="code"><pre>log4j = &#123;
   &#8230;
   warn 'grails.plugin.springsecurity.ui.SpringSecurityUiService'
   &#8230;
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
<code>RegisterController</code> and its GSPs assume that your User domain class has an <code>email</code> field. Be sure to either rework the workflow (using the <code>s2ui-override</code> script) if you don't need an email confirmation step or add an email field.
</blockquote><p class="paragraph"/><h4>RegistrationCode search</h4><p class="paragraph"/>The plugin uses its <code>grails.plugin.springsecurity.ui.RegistrationCode</code> domain class to store a token associated with the new users' username for use when finishing the registration process after the user clicks the link in the generated email (and also as part of the forgot-password workflow). The plugin includes a controller and GSPs to manage these instances.<p class="paragraph"/>The default action for the RegistrationCode controller is search. By default only the standard fields (<code>username</code> and <code>token</code>) are available but this is customizable with the Scripts script - see <a href="../guide/single.html#customization" class="guide">the section on configuration</a> for details.<p class="paragraph"/>You can search by any combination of fields, and both fields have an Ajax autocomplete to assist in finding instances. Leave both fields empty to return all instances.<p class="paragraph"/><img border="0" class="center" src="../img/registration_code_search_start.png"></img><p class="paragraph"/>Searching is case-insensitive and the search string can appear anywhere in the field. Results are shown paginated in groups of 10 and you can click on any header to sort by that field:<p class="paragraph"/><img border="0" class="center" src="../img/registration_code_search_results.png"></img><p class="paragraph"/><h4>RegistrationCode edit</h4><p class="paragraph"/>After clicking through to a RegistrationCode you get to the edit page (there are no view pages):<p class="paragraph"/><img border="0" class="center" src="../img/registration_code_edit.png"></img><p class="paragraph"/>You can update the <code>username</code> or <code>token</code> attribute or delete the RegistrationCode.<p class="paragraph"/>Since instances are created during the "User Registration" and "Forgot Password" workflows, there is no functionality in this plugin to create new instances.



                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/requestmap.html">&lt;&lt; <strong>4</strong><span>Requestmap Management</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/forgotPassword.html"><strong>6</strong><span>Forgot Password</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
